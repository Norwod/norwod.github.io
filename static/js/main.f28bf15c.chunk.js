(this.webpackJsonpreactdroids=this.webpackJsonpreactdroids||[]).push([[0],{13:function(t,i,e){},14:function(t,i,e){},16:function(t,i,e){},17:function(t,i,e){"use strict";e.r(i);var s=e(3),o=e.n(s),n=e(5),h=e.n(n),a=(e(13),e.p,e(14),e(7)),r=e(1),c=e(2),d=e(8),l=e(6);function u(t,i,e){return{x:(t.x-i.x)*Math.cos(e)-(t.y-i.y)*Math.sin(e)+i.x,y:(t.x-i.x)*Math.sin(e)+(t.y-i.y)*Math.cos(e)+i.y}}function y(t,i){return Math.random()*(i-t+1)+t}function p(t,i,e,s){for(var o=y(t,i);o>e&&o<s;)o=Math.random()*(i-t+1)+t;return o}var v=function(){function t(i){Object(r.a)(this,t);var e=u({x:0,y:-20},{x:0,y:0},i.ship.rotation*Math.PI/180);this.position={x:i.ship.position.x+e.x,y:i.ship.position.y+e.y},this.rotation=i.ship.rotation,this.velocity={x:e.x/2,y:e.y/2},this.radius=2}return Object(c.a)(t,[{key:"destroy",value:function(){this.delete=!0}},{key:"render",value:function(t){this.position.x+=this.velocity.x,this.position.y+=this.velocity.y,(this.position.x<0||this.position.y<0||this.position.x>t.screen.width||this.position.y>t.screen.height)&&this.destroy();var i=t.context;i.save(),i.translate(this.position.x,this.position.y),i.rotate(this.rotation*Math.PI/180),i.fillStyle="#FFF",i.lineWidth=.5,i.beginPath(),i.arc(0,0,2,0,2*Math.PI),i.closePath(),i.fill(),i.restore()}}]),t}(),f=function(){function t(i){Object(r.a)(this,t),this.position=i.position,this.velocity=i.velocity,this.radius=i.size,this.lifeSpan=i.lifeSpan,this.inertia=.98}return Object(c.a)(t,[{key:"destroy",value:function(){this.delete=!0}},{key:"render",value:function(t){this.position.x+=this.velocity.x,this.position.y+=this.velocity.y,this.velocity.x*=this.inertia,this.velocity.y*=this.inertia,this.radius-=.1,this.radius<.1&&(this.radius=.1),this.lifeSpan--<0&&this.destroy();var i=t.context;i.save(),i.translate(this.position.x,this.position.y),i.fillStyle="#ffffff",i.lineWidth=2,i.beginPath(),i.moveTo(0,-this.radius),i.arc(0,0,this.radius,0,2*Math.PI),i.closePath(),i.fill(),i.restore()}}]),t}(),x=function(){function t(i){Object(r.a)(this,t),this.position=i.position,this.velocity={x:0,y:0},this.rotation=0,this.rotationSpeed=6,this.speed=.15,this.inertia=.99,this.radius=20,this.lastShot=0,this.create=i.create,this.onDie=i.onDie}return Object(c.a)(t,[{key:"destroy",value:function(){this.delete=!0,this.onDie();for(var t=0;t<60;t++){var i=new f({lifeSpan:y(60,100),size:y(1,4),position:{x:this.position.x+y(-this.radius/4,this.radius/4),y:this.position.y+y(-this.radius/4,this.radius/4)},velocity:{x:y(-1.5,1.5),y:y(-1.5,1.5)}});this.create(i,"particles")}}},{key:"rotate",value:function(t){"LEFT"==t&&(this.rotation-=this.rotationSpeed),"RIGHT"==t&&(this.rotation+=this.rotationSpeed)}},{key:"accelerate",value:function(t){this.velocity.x-=Math.sin(-this.rotation*Math.PI/180)*this.speed,this.velocity.y-=Math.cos(-this.rotation*Math.PI/180)*this.speed;var i=u({x:0,y:-10},{x:0,y:0},(this.rotation-180)*Math.PI/180),e=new f({lifeSpan:y(20,40),size:y(1,3),position:{x:this.position.x+i.x+y(-2,2),y:this.position.y+i.y+y(-2,2)},velocity:{x:i.x/y(3,5),y:i.y/y(3,5)}});this.create(e,"particles")}},{key:"render",value:function(t){if(t.keys.up&&this.accelerate(1),t.keys.left&&this.rotate("LEFT"),t.keys.right&&this.rotate("RIGHT"),t.keys.space&&Date.now()-this.lastShot>300){var i=new v({ship:this});this.create(i,"bullets"),this.lastShot=Date.now()}this.position.x+=this.velocity.x,this.position.y+=this.velocity.y,this.velocity.x*=this.inertia,this.velocity.y*=this.inertia,this.rotation>=360&&(this.rotation-=360),this.rotation<0&&(this.rotation+=360),this.position.x>t.screen.width?this.position.x=0:this.position.x<0&&(this.position.x=t.screen.width),this.position.y>t.screen.height?this.position.y=0:this.position.y<0&&(this.position.y=t.screen.height);var e=t.context;e.save(),e.translate(this.position.x,this.position.y),e.rotate(this.rotation*Math.PI/180),e.strokeStyle="#ffffff",e.fillStyle="#000000",e.lineWidth=2,e.beginPath(),e.moveTo(0,-15),e.lineTo(10,10),e.lineTo(5,7),e.lineTo(-5,7),e.lineTo(-10,10),e.closePath(),e.fill(),e.stroke(),e.restore()}}]),t}(),b=function(){function t(i){Object(r.a)(this,t),this.position=i.position,this.velocity={x:y(-1.5,1.5),y:y(-1.5,1.5)},this.rotation=0,this.rotationSpeed=y(-1,1),this.radius=i.size,this.score=80/this.radius*5,this.create=i.create,this.addScore=i.addScore,this.vertices=function(t,i){for(var e=[],s=0;s<t;s++)e[s]={x:(-Math.sin(360/t*s*Math.PI/180)+Math.round(2*Math.random()-1)*Math.random()/3)*i,y:(-Math.cos(360/t*s*Math.PI/180)+Math.round(2*Math.random()-1)*Math.random()/3)*i};return e}(8,i.size)}return Object(c.a)(t,[{key:"destroy",value:function(){this.delete=!0,this.addScore(this.score);for(var i=0;i<this.radius;i++){var e=new f({lifeSpan:y(60,100),size:y(1,3),position:{x:this.position.x+y(-this.radius/4,this.radius/4),y:this.position.y+y(-this.radius/4,this.radius/4)},velocity:{x:y(-1.5,1.5),y:y(-1.5,1.5)}});this.create(e,"particles")}if(this.radius>10)for(var s=0;s<2;s++){var o=new t({size:this.radius/2,position:{x:y(-10,20)+this.position.x,y:y(-10,20)+this.position.y},create:this.create.bind(this),addScore:this.addScore.bind(this)});this.create(o,"asteroids")}}},{key:"render",value:function(t){this.position.x+=this.velocity.x,this.position.y+=this.velocity.y,this.rotation+=this.rotationSpeed,this.rotation>=360&&(this.rotation-=360),this.rotation<0&&(this.rotation+=360),this.position.x>t.screen.width+this.radius?this.position.x=-this.radius:this.position.x<-this.radius&&(this.position.x=t.screen.width+this.radius),this.position.y>t.screen.height+this.radius?this.position.y=-this.radius:this.position.y<-this.radius&&(this.position.y=t.screen.height+this.radius);var i=t.context;i.save(),i.translate(this.position.x,this.position.y),i.rotate(this.rotation*Math.PI/180),i.strokeStyle="#FFF",i.lineWidth=2,i.beginPath(),i.moveTo(0,-this.radius);for(var e=1;e<this.vertices.length;e++)i.lineTo(this.vertices[e].x,this.vertices[e].y);i.closePath(),i.stroke(),i.restore()}}]),t}(),S=e(0),k=37,j=39,w=38,g=65,O=68,m=87,M=32,P=function(t){Object(d.a)(e,t);var i=Object(l.a)(e);function e(){var t;return Object(r.a)(this,e),(t=i.call(this)).state={screen:{width:window.innerWidth,height:window.innerHeight,ratio:window.devicePixelRatio||1},context:null,keys:{left:0,right:0,up:0,down:0,space:0},asteroidCount:3,currentScore:0,topScore:localStorage.topscore||0,inGame:!1},t.ship=[],t.asteroids=[],t.bullets=[],t.particles=[],t}return Object(c.a)(e,[{key:"handleResize",value:function(t,i){this.setState({screen:{width:window.innerWidth,height:window.innerHeight,ratio:window.devicePixelRatio||1}})}},{key:"handleKeys",value:function(t,i){var e=this.state.keys;i.keyCode!==k&&i.keyCode!==g||(e.left=t),i.keyCode!==j&&i.keyCode!==O||(e.right=t),i.keyCode!==w&&i.keyCode!==m||(e.up=t),i.keyCode===M&&(e.space=t),this.setState({keys:e})}},{key:"componentDidMount",value:function(){var t=this;window.addEventListener("keyup",this.handleKeys.bind(this,!1)),window.addEventListener("keydown",this.handleKeys.bind(this,!0)),window.addEventListener("resize",this.handleResize.bind(this,!1));var i=this.refs.canvas.getContext("2d");this.setState({context:i}),this.startGame(),requestAnimationFrame((function(){t.update()}))}},{key:"componentWillUnmount",value:function(){window.removeEventListener("keyup",this.handleKeys),window.removeEventListener("keydown",this.handleKeys),window.removeEventListener("resize",this.handleResize)}},{key:"update",value:function(){var t=this,i=this.state.context;this.state.keys,this.ship[0];if(i.save(),i.scale(this.state.screen.ratio,this.state.screen.ratio),i.fillStyle="#000",i.globalAlpha=.4,i.fillRect(0,0,this.state.screen.width,this.state.screen.height),i.globalAlpha=1,!this.asteroids.length){var e=this.state.asteroidCount+1;this.setState({asteroidCount:e}),this.generateAsteroids(e)}this.checkCollisionsWith(this.bullets,this.asteroids),this.checkCollisionsWith(this.ship,this.asteroids),this.updateObjects(this.particles,"particles"),this.updateObjects(this.asteroids,"asteroids"),this.updateObjects(this.bullets,"bullets"),this.updateObjects(this.ship,"ship"),i.restore(),requestAnimationFrame((function(){t.update()}))}},{key:"addScore",value:function(t){this.state.inGame&&this.setState({currentScore:this.state.currentScore+t})}},{key:"startGame",value:function(){this.setState({inGame:!0,currentScore:0});var t=new x({position:{x:this.state.screen.width/2,y:this.state.screen.height/2},create:this.createObject.bind(this),onDie:this.gameOver.bind(this)});this.createObject(t,"ship"),this.asteroids=[],this.generateAsteroids(this.state.asteroidCount)}},{key:"gameOver",value:function(){this.setState({inGame:!1}),this.state.currentScore>this.state.topScore&&(this.setState({topScore:this.state.currentScore}),localStorage.topscore=this.state.currentScore)}},{key:"generateAsteroids",value:function(t){for(var i=this.ship[0],e=0;e<t;e++){var s=new b({size:80,position:{x:p(0,this.state.screen.width,i.position.x-60,i.position.x+60),y:p(0,this.state.screen.height,i.position.y-60,i.position.y+60)},create:this.createObject.bind(this),addScore:this.addScore.bind(this)});this.createObject(s,"asteroids")}}},{key:"createObject",value:function(t,i){this[i].push(t)}},{key:"updateObjects",value:function(t,i){var e,s=0,o=Object(a.a)(t);try{for(o.s();!(e=o.n()).done;){e.value.delete?this[i].splice(s,1):t[s].render(this.state),s++}}catch(n){o.e(n)}finally{o.f()}}},{key:"checkCollisionsWith",value:function(t,i){for(var e,s=t.length-1;s>-1;--s)for(e=i.length-1;e>-1;--e){var o=t[s],n=i[e];this.checkCollision(o,n)&&(o.destroy(),n.destroy())}}},{key:"checkCollision",value:function(t,i){var e=t.position.x-i.position.x,s=t.position.y-i.position.y;return Math.sqrt(e*e+s*s)<t.radius+i.radius}},{key:"render",value:function(){var t,i;return i=this.state.currentScore<=0?"0 \u043e\u0447\u043a\u043e\u0432... \u041f\u043b\u043e\u0445\u043e.":this.state.currentScore>=this.state.topScore?"\u041d\u0430\u0431\u0440\u0430\u043d\u043e "+this.state.currentScore+" \u043e\u0447\u043a\u043e\u0432. \u0412\u0430\u0443!":this.state.currentScore+" \u0412\u0441\u0435\u0433\u043e \u043e\u0447\u043a\u043e\u0432 :)",this.state.inGame||(t=Object(S.jsxs)("div",{className:"endgame",children:[Object(S.jsx)("p",{children:"\u0418\u0433\u0440\u0430 \u043e\u043a\u043e\u043d\u0447\u0435\u043d\u0430!"}),Object(S.jsx)("p",{children:i}),Object(S.jsx)("button",{onClick:this.startGame.bind(this),children:"\u041f\u043e\u043f\u0440\u043e\u0431\u043e\u0432\u0430\u0442\u044c \u0435\u0449\u0435?"})]})),Object(S.jsxs)("div",{children:[t,Object(S.jsxs)("span",{className:"score current-score",children:["\u0421\u0447\u0451\u0442: ",this.state.currentScore]}),Object(S.jsxs)("span",{className:"score top-score",children:["\u0422\u043e\u043f \u0441\u0447\u0451\u0442: ",this.state.topScore]}),Object(S.jsxs)("span",{className:"controls",children:["[\u2190][\u2191][\u2192]][\u2193] \u043d\u0430 \u043f\u0443\u043b\u044c\u0442\u0435 \u0434\u043b\u044f \u0434\u0432\u0438\u0436\u0435\u043d\u0438\u044f",Object(S.jsx)("br",{}),"[OK] \u0434\u043b\u044f \u0441\u0442\u0440\u0435\u043b\u044c\u0431\u044b"]}),Object(S.jsx)("canvas",{ref:"canvas",width:this.state.screen.width*this.state.screen.ratio,height:this.state.screen.height*this.state.screen.ratio})]})}}]),e}(s.Component);e(16);var C=function(){return Object(S.jsx)("div",{className:"App",children:Object(S.jsx)(P,{})})},I=function(t){t&&t instanceof Function&&e.e(3).then(e.bind(null,18)).then((function(i){var e=i.getCLS,s=i.getFID,o=i.getFCP,n=i.getLCP,h=i.getTTFB;e(t),s(t),o(t),n(t),h(t)}))};h.a.render(Object(S.jsx)(o.a.StrictMode,{children:Object(S.jsx)(C,{})}),document.getElementById("root")),I()}},[[17,1,2]]]);
//# sourceMappingURL=main.f28bf15c.chunk.js.map